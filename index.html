<!DOCTYPE html>
<html>

<script>
	//global vars
	var masterArray = [];
	var dupCount = 0;
	
	function init() {
	  document.getElementById('fileInput').addEventListener('change', handleFileSelect, false);
	}

	function handleFileSelect(event) {
	  const reader = new FileReader()
	  reader.onload = handleFileLoad;
	  reader.readAsText(event.target.files[0])
	}

	function handleFileLoad(event) {
	    clear();
		var result = event.target.result;
		parse(result);
	}
	
	parse = (result) => {
		clear();
		if(result !== null && result !== undefined && result.trim() !== ''){
			 createHeader();
			 addTools();
			 createTable();
			 result.split('\n').forEach(e => createRow(e));
			 updateHeader(result);
		}
	}

	createHeader = () => {
		var item = document.getElementById('fileContent');
		var header = document.createElement("h4");
		header.id = 'count';
		item.appendChild(header);
	}

	updateHeader = (result) => {
			var header = document.getElementById("count");
			rows = result.split('\n').length;
			cols = result.split('\n')[0].split(',').length;
			header.innerHTML = 'Rows : '+rows + ', Columns : '+cols + ', Duplicates : '+dupCount;
	}

	createTable = () => {
			masterArray = [];
			var item = document.getElementById('fileContent');
			var table = document.createElement("table");
			table.id = 'resultTable';
			table.style.border= '1px solid black';
			table.style.borderCollapse = 'collapse';
			item.appendChild(table);
	}

	function createRow(e){
		e = e.trim();
		if(e === '') return null;
		var table = document.getElementById('resultTable');
		var tr = document.createElement("tr");
		e.split(',').forEach(e1 => tr.appendChild(createCol(e1)));
		if(masterArray.includes(e)){
			console.log('duplicate entry '+e);
			tr.style.color='red';
			dupCount++;
		}
		masterArray.push(e);
		table.appendChild(tr);
	}

	createCol = (e) => {
		var td = document.createElement("td");
		td.style.border = '1px solid black';
		var node = document.createTextNode(e);
		td.appendChild(node);
		return td;

	}

	clear = () => {
		masterArray = [];
		dupCount = 0;
		document.getElementById('fileContent').innerHTML = '';
	}
	
	addTools = () => {
		var item = document.getElementById('fileContent');
		var toolBar = document.createElement('div');
		toolBar.style.padding = '10px 10px 10px 10px';
		item.appendChild(toolBar);
		addRemoveDuplicateButton(toolBar);
	}
	
	addRemoveDuplicateButton = (toolBar) => {
		var button = document.createElement('input');
		button.type = 'button';
		button.value = 'Remove Duplicates';
		button.setAttribute("onclick","removeDup();");
		toolBar.appendChild(button);
	}
	
	removeDup = () => {
		
		var temp = '';
		var tempArray = [];
		
		masterArray.forEach( e => {
			if(!tempArray.includes(e)){
				tempArray.push(e);
				temp += e +'\n';
			}
		});
		
		parse(temp);
	}
	
</script>

<body onload="init()">
  <input id="fileInput" type="file" name="file" />
  <div id="fileContent"></div>
</body>

</html>